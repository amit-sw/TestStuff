<!doctype html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Schovia | Emotion Detect Gym</title><style>:root{--bg:#08101d;--panel:#101a2e;--panel2:#15233d;--line:#2a3f68;--text:#e8f0ff;--muted:#9db2d8}*{box-sizing:border-box}body{margin:0;background:radial-gradient(circle at 20% 10%,#172a4b,var(--bg) 45%),#08101d;color:var(--text);font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif}.app{width:min(1050px,95vw);margin:28px auto;display:grid;gap:14px}.topbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.brand-lockup{margin-right:auto}.brand-logo{height:52px}.badge{font-size:.86rem;color:var(--muted);border:1px solid var(--line);border-radius:999px;padding:4px 10px}.section{background:linear-gradient(165deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:16px;padding:14px}.controls{display:flex;gap:10px;flex-wrap:wrap}button{border-radius:10px;border:1px solid #2d4d82;background:#1f5fbf;color:var(--text);padding:8px 10px;cursor:pointer}.stage{position:relative;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0b1529}video,canvas{width:100%;max-height:64vh;display:block}canvas{position:absolute;inset:0}.chips{display:flex;flex-wrap:wrap;gap:8px}.chip{border-radius:10px;border:1px solid #2d4d82;background:#132746;padding:6px 8px;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:.86rem}</style><script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script></head><body><main class="app"><div class="topbar"><div class="brand-lockup"><img class="brand-logo" src="https://schovia.com/wp-content/uploads/2025/09/backConcept-2-Color-copy-2.svg" alt="Schovia logo"/></div><h1>Emotion Detection</h1><span class="badge">Client-side face-api.js</span></div><section class="section"><div class="controls"><button id="start">Start</button><button id="speak">Speak top emotion</button></div></section><section class="section"><div class="stage"><video id="v" autoplay muted playsinline></video><canvas id="c"></canvas></div></section><section class="section"><div id="scores" class="chips"></div></section></main><script>const v=document.getElementById('v'),c=document.getElementById('c'),ctx=c.getContext('2d'),scores=document.getElementById('scores');let run=false,stream=null,last='';function render(exp){scores.innerHTML='';const arr=Object.entries(exp||{}).sort((a,b)=>b[1]-a[1]);if(!arr.length){scores.innerHTML='<span class="chip">No face detected</span>';return;}last=arr[0][0];arr.forEach(([k,v])=>{const s=document.createElement('span');s.className='chip';s.textContent=`${k}: ${(v*100).toFixed(1)}%`;scores.appendChild(s);});}async function start(){if(run)return;stream=await navigator.mediaDevices.getUserMedia({video:true,audio:false});v.srcObject=stream;await new Promise(r=>v.onloadedmetadata=r);await v.play();c.width=v.videoWidth;c.height=v.videoHeight;const URL='https://pyxedapackages.s3.amazonaws.com/models/face_expression';await faceapi.nets.tinyFaceDetector.loadFromUri(URL);await faceapi.nets.faceLandmark68Net.loadFromUri(URL);await faceapi.nets.faceRecognitionNet.loadFromUri(URL);await faceapi.nets.faceExpressionNet.loadFromUri(URL);run=true;loop();}async function loop(){if(!run)return;const r=await faceapi.detectSingleFace(v,new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();ctx.clearRect(0,0,c.width,c.height);if(r){const b=r.detection.box;ctx.strokeStyle='#74c7ff';ctx.lineWidth=3;ctx.strokeRect(b.x,b.y,b.width,b.height);render(r.expressions);}else render();requestAnimationFrame(loop);}document.getElementById('start').onclick=()=>start().catch(e=>alert(e.message));document.getElementById('speak').onclick=()=>{if(!last)return;const u=new SpeechSynthesisUtterance(last);speechSynthesis.cancel();speechSynthesis.speak(u);};</script></body></html>
